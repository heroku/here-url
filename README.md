# URInception
[Data URLs](http://en.wikipedia.org/wiki/Data_URI_scheme) over HTTP.

## What
[Data URLs](http://en.wikipedia.org/wiki/Data_URI_scheme) are great for encoding 
small amounts of data directly in a URL without requiring a server or storage; 
however, they are mostly only supported in web browsers. URInception allows
Data URLs to be used with any HTTP client, such as `curl`.

For example, this is a Data URL of an image of a red dot:

    data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==

Modern web browsers can load this directly, but many clients don't understand the `data` scheme. 
URInception is a simple service that serves Data URLs over HTTP. Here is the same image over HTTP:

    http://urinception.herokuapp.com/?url=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4%2F%2F8%2Fw38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg%3D%3D

URInception

## Why
This is primarily used for integration testing file downloads with contents that can be dynamically
generated by the tests themselves. Instead of creating static test fixtures, hosting them somewhere, 
and hard coding the URL in tests, this service allows the tests to generate Data URLs on the fly
without having the host the file anywhere. If clients like `curl` supported Data URLs directly, 
this service would not be needed, but this acts an adapter for such clients.

## How
URLs for use with this service can be constructed by the client or server. It is more efficient and simple enough to create them client-side, but a server-side URL builder is provided as convenience and for RESTful symmetry. 

### Client-Side

1. Create a Data URL as described in [RFC 2397](https://www.ietf.org/rfc/rfc2397.txt).
2. URL encode the Data URL as described in [RFC 2396](http://www.ietf.org/rfc/rfc2396.txt).
3. Create a URL with encoded string as the value of the `url` query parameter on any path this service.

See the [syntax](#syntax) below for details.

### Server-Side

POST data to any path on this service and an URL will be returned. 
If a `Content-Type` header is include, it will be used as the Data URL's `mediatype`;
otherwise, the `mediatype` will be guessed from the data. 

For example, to create a the URL of the red dot above:

    $ curl http://urinception.herokuapp.com -X POST --data-binary @reddot.png
    http://urinception.herokuapp.com/?url=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4%2F%2F8%2Fw38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg%3D%3D

The `mediatype` will automatically be detected as `image/png`; however, if you want to specify it yourself, set the `Content-Type` header

    $ curl http://urinception.herokuapp.com -X POST --data-binary '<tag/>' -H 'Content-Type: text/xml'
    http://urinception.herokuapp.com/?url=data%3Atext%2Fxml%3Bbase64%2CPHRhZy8%2B

So far these example have not specified a path; however, if one is specified, it will be returned in the URL. This is helpful for clients that expect certain paths or file extensions. The XML example again with a path:

    $ curl http://urinception.herokuapp.com/example.xml -X POST --data-binary '<tag/>' -H 'Content-Type: text/xml'
    http://urinception.herokuapp.com/example.xml?url=data%3Atext%2Fxml%3Bbase64%2CPHRhZy8%2B

## Syntax
```
httpurl    := "http" [ "s" ] "://" host *urlchar "?url=" dataurl
dataurl    := "data:" [ mediatype ] [ ";base64" ] "," data
mediatype  := [ type "/" subtype ] *( ";" parameter )
data       := *urlchar
parameter  := attribute "=" value
```